<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Riba Run</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>
    html, body {
        margin: 0;
        padding: 0;
        overflow: hidden;
        background: #0a0014;
    }
    canvas {
        display: block;
        width: 100vw;
        height: 100vh;
    }
</style>
</head>

<body>
<canvas id="game"></canvas>

<script>
/* ============================================================
   RIBA RUN — PURE JAVASCRIPT EDITION
   No React, No Frameworks, Works on GitHub Pages instantly
   ============================================================ */

const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

/* ============================================================
   GAME CONSTANTS
============================================================ */
const GROUND_HEIGHT = 100;
const PLAYER_WIDTH = 48;
const PLAYER_HEIGHT = 56;
const PLAYER_SLIDE_HEIGHT = 28;
const GRAVITY = 0.55;
const JUMP_FORCE = -14;
const INITIAL_SPEED = 4.5;
const MAX_SPEED = 10;
const SPEED_INCREMENT = 0.0006;

/* ============================================================
   GAME STATE
============================================================ */
const game = {
    player: { x: 120, y: 0, vy: 0, jumping: false, sliding: false, slideTime: 0 },
    coins: [],
    particles: [],
    powerUps: [],
    monster: { x: -200, targetX: -200, size: 1 },
    speed: INITIAL_SPEED,
    score: 0,
    green: 0,
    red: 0,
    necessity: 100,
    frame: 0,
    running: true,
    hasCard: false,
    cardTimer: 0,
    glitch: 0,
    groundY: canvas.height - GROUND_HEIGHT,
};

/* ============================================================
   INPUT HANDLING
============================================================ */
function jump() {
    if (!game.running) return;
    if (!game.player.jumping || game.player.y >= game.groundY - PLAYER_HEIGHT) {
        game.player.vy = JUMP_FORCE;
        game.player.jumping = true;
    }
}

function slide() {
    if (!game.running) return;
    if (!game.player.jumping && !game.player.sliding) {
        game.player.sliding = true;
        game.player.slideTime = 35;
    }
}

window.addEventListener("keydown", (e) => {
    if (e.code === "Space" || e.code === "ArrowUp") jump();
    if (e.code === "ArrowDown") slide();
});

canvas.addEventListener("touchstart", (e) => {
    const y = e.touches[0].clientY;
    if (y > window.innerHeight / 2) slide();
    else jump();
});

/* ============================================================
   COIN SPAWNING
============================================================ */
function spawnCoin() {
    const isGreen = Math.random() < 0.6;

    if (isGreen) {
        let yPos = game.groundY - [50, 80, 120][Math.floor(Math.random() * 3)];

        for (let i = 0; i < 3; i++) {
            game.coins.push({
                x: canvas.width + i * 40,
                y: yPos,
                r: 18,
                green: true,
                pulse: Math.random() * 6.2,
            });
        }
    } else {
        game.coins.push({
            x: canvas.width,
            y: game.groundY - 50,
            r: 14,
            green: false,
            pulse: Math.random() * 6.2,
        });
    }
}

/* ============================================================
   KESTRL CARD
============================================================ */
function spawnCard() {
    if (Math.random() < 0.18 && !game.hasCard) {
        game.powerUps.push({
            x: canvas.width + 50,
            y: game.groundY - 120,
            w: 50,
            h: 30,
            pulse: 0,
        });
    }
}

/* ============================================================
   PARTICLES
============================================================ */
function particles(x, y, color, count = 10) {
    for (let i = 0; i < count; i++) {
        game.particles.push({
            x, y,
            vx: (Math.random() - 0.5) * 8,
            vy: (Math.random() - 0.5) * 8,
            life: 1,
            color,
            size: Math.random() * 4 + 2,
        });
    }
}

/* ============================================================
   GAME LOOP UPDATE
============================================================ */
function update() {
    if (!game.running) return;

    game.frame++;
    if (game.speed < MAX_SPEED) game.speed += SPEED_INCREMENT;

    game.necessity = Math.max(0, game.necessity - 0.03);
    if (game.necessity <= 0) game.score -= 0.5;

    /* Player physics */
    if (game.player.sliding) {
        game.player.slideTime--;
        if (game.player.slideTime <= 0) game.player.sliding = false;
    }

    game.player.vy += GRAVITY;
    game.player.y += game.player.vy;

    let pHeight = game.player.sliding ? PLAYER_SLIDE_HEIGHT : PLAYER_HEIGHT;

    if (game.player.y >= game.groundY - pHeight) {
        game.player.y = game.groundY - pHeight;
        game.player.vy = 0;
        game.player.jumping = false;
    }

    /* Coins */
    game.coins = game.coins.filter((coin) => {
        coin.x -= game.speed;
        coin.pulse += 0.15;

        const dx = coin.x - (game.player.x + PLAYER_WIDTH / 2);
        const dy = coin.y - (game.player.y + pHeight / 2);
        const dist = Math.sqrt(dx * dx + dy * dy);

        if (dist < coin.r + 35) {
            if (coin.green) {
                game.score += 10;
                game.green++;
                game.necessity = Math.min(100, game.necessity + 12);
                particles(coin.x, coin.y, "#10b981");
            } else {
                game.score -= 50;
                game.red++;
                game.necessity = Math.min(100, game.necessity + 5);
                particles(coin.x, coin.y, "#ef4444");
            }
            return false;
        }
        return coin.x > -50;
    });

    /* Kestrel Card */
    game.powerUps = game.powerUps.filter((pu) => {
        pu.x -= game.speed;
        pu.pulse += 0.15;

        if (
            game.player.x + PLAYER_WIDTH > pu.x &&
            game.player.x < pu.x + pu.w &&
            game.player.y + pHeight > pu.y &&
            game.player.y < pu.y + pu.h
        ) {
            game.hasCard = true;
            game.cardTimer = 600;
            particles(pu.x, pu.y, "#00ffff", 20);
            return false;
        }

        return pu.x > -100;
    });

    if (game.hasCard) {
        game.cardTimer--;
        if (game.cardTimer <= 0) game.hasCard = false;
    }

    /* Riba Monster */
    if (game.score < 0) {
        let debt = Math.abs(game.score);
        game.monster.targetX = -200 + Math.min(debt * 1.5, game.player.x - 40);
        game.monster.size = 1 + Math.min(debt / 200, 1.8);
    } else {
        game.monster.targetX = -200;
        game.monster.size = Math.max(1, game.monster.size - 0.03);
    }

    if (game.hasCard) {
        game.monster.targetX -= 100;
    }

    game.monster.x += (game.monster.targetX - game.monster.x) * 0.05;

    if (game.monster.x >= game.player.x - 20) {
        game.running = false;
        alert("GAME OVER — Your score: " + Math.floor(game.score));
    }

    /* Glitch effect */
    if (game.score < -150) {
        game.glitch = Math.min(1, (Math.abs(game.score) - 150) / 180);
    } else {
        game.glitch = Math.max(0, game.glitch - 0.02);
    }

    /* Spawn */
    if (game.frame % 50 === 0) spawnCoin();
    if (game.frame % 110 === 0) spawnCard();

    /* Particles */
    game.particles = game.particles.filter((p) => {
        p.x += p.vx;
        p.y += p.vy;
        p.life -= 0.03;
        return p.life > 0;
    });
}

/* ============================================================
   DRAW FUNCTION
============================================================ */
function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    /* Background */
    const g = ctx.createLinearGradient(0, 0, 0, canvas.height);
    g.addColorStop(0, "#1a0a2e");
    g.addColorStop(0.5, "#4a3070");
    g.addColorStop(1, "#6b4d8a");
    ctx.fillStyle = g;
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    /* Stars */
    ctx.fillStyle = "#ffffff";
    for (let i = 0; i < 40; i++) {
        let x = (i * 122 + game.frame * 0.2) % canvas.width;
        let y = (i * 87) % (game.groundY - 100);
        ctx.fillRect(x, y, 2, 2);
    }

    /* Ground */
    ctx.fillStyle = "#a8844a";
    ctx.fillRect(0, game.groundY, canvas.width, GROUND_HEIGHT);

    /* Monster */
    ctx.fillStyle = "rgba(120,0,0,0.6)";
    ctx.beginPath();
    ctx.arc(game.monster.x, game.groundY - 40, 40 * game.monster.size, 0, Math.PI * 2);
    ctx.fill();

    /* Coins */
    game.coins.forEach((c) => {
        ctx.fillStyle = c.green ? "#00ff88" : "#ff4444";
        ctx.beginPath();
        ctx.arc(c.x, c.y, c.r, 0, 6.28);
        ctx.fill();
    });

    /* Power-ups */
    game.powerUps.forEach((pu) => {
        ctx.fillStyle = "#00ffff";
        ctx.fillRect(pu.x, pu.y, pu.w, pu.h);
    });

    /* Player */
    ctx.fillStyle = "#ffaa00";
    ctx.fillRect(
        game.player.x,
        game.player.y,
        PLAYER_WIDTH,
        game.player.sliding ? PLAYER_SLIDE_HEIGHT : PLAYER_HEIGHT
    );

    /* Particles */
    game.particles.forEach((p) => {
        ctx.globalAlpha = p.life;
        ctx.fillStyle = p.color;
        ctx.fillRect(p.x, p.y, p.size, p.size);
    });
    ctx.globalAlpha = 1;

    /* Glitch effect */
    if (game.glitch > 0) {
        ctx.fillStyle = `rgba(255,0,0,${game.glitch * 0.2})`;
        ctx.fillRect(0, 0, canvas.width, canvas.height);
    }
}

/* ============================================================
   MAIN LOOP
============================================================ */
function loop() {
    update();
    draw();
    requestAnimationFrame(loop);
}

loop();
</script>
</body>
</html>


    


